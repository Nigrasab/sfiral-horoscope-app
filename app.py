from flask import Flask, request, render_template
from datetime import datetime

app = Flask(__name__)

# Таблица фаз по пятилеткам (фрагмент, дополни при необходимости)
phases = {
    (0, 5): "Зачатие импульса. Формирование основы телесности.",
    (5, 10): "Формирование восприятия. Впитывание мира.",
    (10, 15): "Ускорение. Индивидуализация начинается.",
    (15, 20): "Распускание потенциала. Внутренний рост.",
    (20, 25): "Становление. Появление линии судьбы.",
    (25, 30): "Концентрация. Действие по оси намерения.",
    (30, 35): "Упрочнение. Проверка выбранного пути.",
    (35, 40): "Переход к границе витка. Подготовка к повороту.",
    (40, 45): "Дуга разворота. Снятие ожиданий.",
    (45, 50): "Поворот оси. Встреча с подлинным.",
    (50, 55): "Антидвижение. Начало возврата к истоку.",
    (55, 60): "Антиусиление. Переосмысление силы.",
    (60, 65): "Антивозраст. Начало распускания формы.",
    (65, 70): "Антитепло. Возвращение глубины чувств.",
    (70, 75): "Антисвет. Ясность без образа.",
    (75, 80): "Разуплотнение. Расширение внутреннего.",
    (80, 85): "Перелив в прозрачность. Снятие плотности.",
    (85, 90): "Приближение к пустотному центру.",
    (90, 95): "Распад облика. Внутреннее присутствие.",
    (95, 100): "Покой витка. Вход в пунктир.",
    (100, 105): "Пунктир времени. Дополнительное пространство.",
    (105, 110): "Присутствие вне формы.",
    (110, 115): "Сохранение в незримом.",
    (115, 120): "Исчезновение границ. Я есмь полное растворение."
}

@app.route("/")
def home():
    return render_template("index.html")

@app.route("/horoscope", methods=["POST"])
def horoscope():
    date_str = request.form.get("birthdate")
    if not date_str:
        return "Дата не указана."

    try:
        birthdate = datetime.strptime(date_str, "%Y-%m-%d")
        today = datetime.today()
        age = today.year - birthdate.year - ((today.month, today.day) < (birthdate.month, birthdate.day))

        for (start, end), msg in phases.items():
            if start <= age < end:
                return render_template("result.html", age=age, phase=f"{start}–{end} лет", text=msg)

        return render_template("result.html", age=age, phase="Вне диапазона", text="Фаза не определена.")
    except Exception as e:
        return f"Ошибка: {e}"

if __name__ == "__main__":
    app.run(debug=True)
