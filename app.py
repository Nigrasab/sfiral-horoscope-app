from flask import Flask, request, render_template
from datetime import datetime

app = Flask(__name__)

phases = {
    (0, 5): "Зачатие импульса. Формирование основы телесности.",
    (5, 10): "Формирование восприятия. Впитывание мира.",
    (10, 15): "Ускорение. Индивидуализация начинается.",
    (15, 20): "Созревание. Энергия направлена вовне.",
    (20, 25): "Выход в самостоятельность. Экспансия.",
    (25, 30): "Фиксация намерения. Контроль за траекторией.",
    (30, 35): "Реализация. Материализация образа.",
    (35, 40): "Завершение витка. Удержание целого.",
    (40, 45): "Вход в петлю. Отпускание, внутреннее слушание.",
    (45, 50): "Изгиб траектории. Формирование оси разворота.",
    (50, 55): "Фаза разрыва. Переформатирование цели.",
    (55, 60): "Рождение нового направления. Переход.",
    (60, 65): "Начало антивитка. Движение внутрь.",
    (65, 70): "Углубление. Работа с причинами.",
    (70, 75): "Сжатие. Восстановление целостности.",
    (75, 80): "Прояснение. Движение к центру.",
    (80, 85): "Созерцание. Подъём смысла.",
    (85, 90): "Пространство мудрости. Синтез.",
    (90, 95): "Энергия покоя. Поддержка других.",
    (95, 100): "Распускание. Отдача формы.",
    (100, 105): "Тонкое пребывание. След.",
    (105, 110): "Освобождение. Выход за пределы.",
    (110, 115): "Возврат к точке начала. Ожидание.",
    (115, 120): "Растворение. Покой. Благословение."
}

@app.route("/", methods=["GET", "POST"])
def index():
    result = ""
    if request.method == "POST":
        date_str = request.form.get("birthdate")
        if date_str:
            try:
                birthdate = datetime.strptime(date_str, "%Y-%m-%d")
                today = datetime.today()
                age = today.year - birthdate.year - ((today.month, today.day) < (birthdate.month, birthdate.day))

                for (start, end), text in phases.items():
                    if start <= age < end:
                        result = f"<h3>{start}–{end} лет</h3><p>{text}</p>"
                        break
                if not result:
                    result = "<p>Возраст вне допустимого диапазона (0–120).</p>"
            except Exception as e:
                result = f"<p>Ошибка: {e}</p>"
        else:
            result = "<p>Дата не указана.</p>"
    return render_template("index.html", result=result)
