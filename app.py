from flask import Flask, request, render_template
from datetime import datetime

app = Flask(__name__)

phases = {
    (0, 5): "Зачатие импульса. Формирование основы телесности.",
    (5, 10): "Формирование восприятия. Впитывание мира.",
    (10, 15): "Ускорение. Индивидуализация начинается.",
    (15, 20): "Порог самосознания. Разделение на «я» и «не-я».",
    (20, 25): "Расширение горизонта. Первая проекция во внешний мир.",
    (25, 30): "Консолидация. Начало траектории зрелости.",
    (30, 35): "Нагрузка. Точка ответственного выбора.",
    (35, 40): "Разгрузка. Первые отзвуки обратимости.",
    (40, 45): "Вход в S-петлю. Глубокий пересмотр опыта.",
    (45, 50): "Дуга памяти. Возврат к импульсу юности.",
    (50, 55): "Антидуга прозрения. Выход в новое качество.",
    (55, 60): "Сборка смысла. Установление внутреннего фокуса.",
    (60, 65): "Начало антивитка. Воспроизведение себя в отражении.",
    (65, 70): "Распаковка памяти. Активное обобщение.",
    (70, 75): "Переход к чистому созерцанию.",
    (75, 80): "Гармонизация форм. Плавное схождение.",
    (80, 85): "Контур обратного витка. Смягчение различий.",
    (85, 90): "Фаза нематериального. Синтез сущностного.",
    (90, 95): "Растворение функции. Временные смещения.",
    (95, 100): "Контрольный фокус. Завершение кривой.",
    (100, 105): "Сбор остаточного импульса.",
    (105, 110): "Снятие контура. Финальное эхо.",
    (110, 115): "Разворачивание к другому плану.",
    (115, 120): "Исчезновение границ. Я есмь полное растворение."
}

@app.route("/", methods=["GET", "POST"])
def index():
    result = ""
    if request.method == "POST":
        date_str = request.form.get("date")
        try:
            birthdate = datetime.strptime(date_str, "%Y-%m-%d")
            today = datetime.today()
            age = today.year - birthdate.year - ((today.month, today.day) < (birthdate.month, birthdate.day))

            for (start, end), msg in phases.items():
                if start <= age < end:
                    result = f"<h3>{start}–{end} лет</h3><p>{msg}</p>"
                    break
            else:
                result = "Возраст вне диапазона."
        except:
            result = "Неверный формат даты."

    return render_template("index.html", result=result)
